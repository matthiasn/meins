agents:
  os: "linux"

steps:
  - label: "ğŸ§ Clean ğŸ§½, ğŸ›  build ğŸ› , ğŸ”¬ test ğŸ”¬ "
    key: "linux_clean_test"
    command:
    - "make clean_test"
    - "mkdir -p /tmp/buildkite/$$BUILDKITE_COMMIT/"
    - "rsync -ar ./ /tmp/buildkite/$$BUILDKITE_COMMIT/"

  - label: "ğŸ§ Linux Build ğŸ­ "
    key: "linux_build"
    depends_on:
      - "linux_clean_test"
    command:
    - "rsync -ar /tmp/buildkite/$$BUILDKITE_COMMIT/ ./"
    - "make linux_build"
    - "tar cfvz build/linux.x64.tar.gz build/linux"
    - "rsync -ar ./ /tmp/buildkite/$$BUILDKITE_COMMIT/"
    artifact_paths:
      - "missing_translations.txt"

  - label: "ğŸ§ Linux publish GitHub prerelease ğŸš€ "
    key: "linux_github_prerelease"
    depends_on:
      - "linux_build"
    command:
      - "rsync -ar /tmp/buildkite/$$BUILDKITE_COMMIT/ ./"
      - "gh release create -p -d --generate-notes --target $$BUILDKITE_COMMIT $$BUILDKITE_BRANCH build/linux.x64.tar.gz"
